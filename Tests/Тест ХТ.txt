#include <iostream>
#include <vector>
#include <string>
#include <iomanip>
#include <limits>
#include <fstream>
#include <sstream>
#include "ProductHashTable.h"

using namespace std;

class HashTableTester {
private:
    ProductHashTable* hashTable;
    vector<Product> products;

    void printMenu() {
        cout << "\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó";
        cout << "\n‚ïë         –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –•–ï–®-–¢–ê–ë–õ–ò–¶–´      ‚ïë";
        cout << "\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£";
        cout << "\n‚ïë 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É          ‚ïë";
        cout << "\n‚ïë 2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä                     ‚ïë";
        cout << "\n‚ïë 3. –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É          ‚ïë";
        cout << "\n‚ïë 4. –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É            ‚ïë";
        cout << "\n‚ïë 5. –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã                ‚ïë";
        cout << "\n‚ïë 6. –ü–æ–∫–∞–∑–∞—Ç—å —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É (–æ—Ç–ª–∞–¥–∫–∞)     ‚ïë";
        cout << "\n‚ïë 7. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞                 ‚ïë";
        cout << "\n‚ïë 8. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª                   ‚ïë";
        cout << "\n‚ïë 9. –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É                   ‚ïë";
        cout << "\n‚ïë 10. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∞–±–ª–∏—Ü—ã       ‚ïë";
        cout << "\n‚ïë 11. –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ               ‚ïë";
        cout << "\n‚ïë 0. –í—ã—Ö–æ–¥                              ‚ïë";
        cout << "\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù";
        cout << "\n‚ñ∂ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: ";
    }

    void createHashTable() {
        if (hashTable) {
            delete hashTable;
        }

        int size;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã: ";
        cin >> size;

        if (size <= 0) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Ä–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º!\n";
            return;
        }

        hashTable = new ProductHashTable(size);
        products.clear();
        cout << "‚úî –•–µ—à-—Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å —Ä–∞–∑–º–µ—Ä–æ–º " << size << endl;
    }

    void addProduct() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        Product product;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª: ";
        cin >> product.article;

        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: ";
        cin.ignore();
        getline(cin, product.name);

        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É: ";
        cin >> product.price;

        if (product.price < 0) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π!\n";
            return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–æ–≤–∞—Ä —Å —Ç–∞–∫–∏–º –∞—Ä—Ç–∏–∫—É–ª–æ–º
        int steps;
        int existingIndex = hashTable->search(product.article, steps);

        if (existingIndex != -1) {
            cout << "‚ö† –¢–æ–≤–∞—Ä —Å –∞—Ä—Ç–∏–∫—É–ª–æ–º " << product.article << " —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.\n";
            cout << "   –¢–µ–∫—É—â–∏–π —Ç–æ–≤–∞—Ä: " << products[existingIndex].name
                 << " (—Ü–µ–Ω–∞: " << products[existingIndex].price << ")\n";
            cout << "   –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ? (y/n): ";
            char choice;
            cin >> choice;

            if (choice == 'y' || choice == 'Y') {
                products[existingIndex] = product;
                cout << "‚úî –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã\n";
            } else {
                cout << "‚å´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n";
            }
            return;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
        int newIndex = products.size();
        products.push_back(product);

        if (hashTable->insert(product.article, newIndex)) {
            cout << "‚úî –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω (–∏–Ω–¥–µ–∫—Å: " << newIndex << ")\n";
        } else {
            cout << "‚úñ –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É\n";
            products.pop_back(); // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
        }
    }

    void removeProduct() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        int article;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ";
        cin >> article;

        int steps;
        int index = hashTable->search(article, steps);

        if (index == -1) {
            cout << "‚úñ –¢–æ–≤–∞—Ä —Å –∞—Ä—Ç–∏–∫—É–ª–æ–º " << article << " –Ω–µ –Ω–∞–π–¥–µ–Ω\n";
            return;
        }

        cout << "   –ù–∞–π–¥–µ–Ω —Ç–æ–≤–∞—Ä: " << products[index].name
             << " (—Ü–µ–Ω–∞: " << products[index].price << ")\n";
        cout << "   –£–¥–∞–ª–∏—Ç—å? (y/n): ";
        char choice;
        cin >> choice;

        if (choice == 'y' || choice == 'Y') {
            if (hashTable->remove(article)) {
                cout << "‚úî –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã\n";
                cout << "‚Ñπ –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Ç–æ–≤–∞—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤–µ, –Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫\n";
            } else {
                cout << "‚úñ –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏\n";
            }
        } else {
            cout << "‚å´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n";
        }
    }

    void searchProduct() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        int article;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª –¥–ª—è –ø–æ–∏—Å–∫–∞: ";
        cin >> article;

        int steps;
        int index = hashTable->search(article, steps);

        if (index != -1) {
            const Product& product = products[index];
            cout << "‚úî –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω –∑–∞ " << steps << " —à–∞–≥–æ–≤:\n";
            cout << "   –ê—Ä—Ç–∏–∫—É–ª: " << product.article << endl;
            cout << "   –ù–∞–∑–≤–∞–Ω–∏–µ: " << product.name << endl;
            cout << "   –¶–µ–Ω–∞: " << fixed << setprecision(2) << product.price << " —Ä—É–±." << endl;
            cout << "   –ò–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ: " << index << endl;
        } else {
            cout << "‚úñ –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω (–ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å " << steps << " —à–∞–≥–æ–≤)\n";
        }
    }

    void showAllProducts() {
        if (products.empty()) {
            cout << "‚Ñπ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç\n";
            return;
        }

        cout << "\n‚ïê‚ïê‚ïê –°–ü–ò–°–û–ö –í–°–ï–• –¢–û–í–ê–†–û–í ‚ïê‚ïê‚ïê\n";
        cout << left << setw(10) << "–ò–Ω–¥–µ–∫—Å" << setw(12) << "–ê—Ä—Ç–∏–∫—É–ª"
             << setw(25) << "–ù–∞–∑–≤–∞–Ω–∏–µ" << setw(10) << "–¶–µ–Ω–∞" << endl;
        cout << string(60, '-') << endl;

        for (size_t i = 0; i < products.size(); ++i) {
            const Product& p = products[i];
            cout << left << setw(10) << i << setw(12) << p.article
                 << setw(25) << p.name << setw(10) << fixed << setprecision(2) << p.price << endl;
        }
        cout << "\n–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: " << products.size() << endl;
    }

    void showHashTable() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        cout << "\n‚ïê‚ïê‚ïê –û–¢–õ–ê–î–û–ß–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –•–ï–®-–¢–ê–ë–õ–ò–¶–ï ‚ïê‚ïê‚ïê\n";
        cout << "Capacity: " << hashTable->getCapacity() << ", Size: " << hashTable->getSize()
             << ", Load Factor: " << fixed << setprecision(2) << hashTable->getLoadFactor() << endl;
        cout << "\n–õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤: 0 = EMPTY, 1 = OCCUPIED, 2 = DELETED\n";
        cout << endl;

        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        int emptyCount = 0, occupiedCount = 0, deletedCount = 0;

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —Å–ª–æ—Ç–µ
        for (int i = 0; i < hashTable->getCapacity(); ++i) {
            HashEntry slot = hashTable->getSlotInfo(i);
            cout << "Slot " << setw(3) << i << ": ";

            if (slot.status == 0) {
                cout << "[EMPTY] Status=0";
                emptyCount++;
            }
            else if (slot.status == 1) {
                cout << "[OCCUPIED] Status=1, Key=" << slot.key
                     << ", Index=" << slot.index;
                occupiedCount++;
            }
            else if (slot.status == 2) {
                cout << "[DELETED] Status=2, Key=" << slot.key
                     << ", Index=" << slot.index;
                deletedCount++;
            }
            else {
                cout << "[UNKNOWN] Status=" << slot.status;
            }

            cout << endl;
        }

        cout << "\n‚ïê‚ïê‚ïê –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–õ–û–¢–û–í ‚ïê‚ïê‚ïê\n";
        cout << "–ü—É—Å—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (0): " << emptyCount << endl;
        cout << "–ó–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (1): " << occupiedCount << endl;
        cout << "–£–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (2): " << deletedCount << endl;
        cout << "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n";
    }

    void loadFromFile() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        string filename;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞: ";
        cin >> filename;

        cout << "   ‚ñ∑ –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞? (0 = –≤—Å–µ): ";
        int maxLines;
        cin >> maxLines;

        if (maxLines < 0) {
            cout << "‚úñ –û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º!\n";
            return;
        }

        if (loadFromFileWithLimit(filename, maxLines)) {
            cout << "‚úî –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞ " << filename << endl;
            cout << "   –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞—Å—Å–∏–≤: " << products.size() << endl;
            cout << "   –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É: " << hashTable->getSize() << endl;
        } else {
            cout << "‚úñ –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ " << filename << endl;
        }
    }

    bool loadFromFileWithLimit(const string& filename, int maxLines) {
        ifstream file(filename);
        if (!file.is_open()) {
            return false;
        }

        products.clear();
        hashTable->clear();

        string line;
        int index = 0;
        int loadedLines = 0;
        int successfulInserts = 0;

        while (getline(file, line) && (maxLines == 0 || loadedLines < maxLines)) {
            istringstream iss(line);
            Product product;

            if (!(iss >> product.article >> product.name >> product.price)) {
                continue;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            }

            products.push_back(product);

            if (hashTable->insert(product.article, index)) {
                successfulInserts++;
            } else {
                cout << "‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É —Ç–æ–≤–∞—Ä: "
                     << product.article << " " << product.name << endl;
            }

            index++;
            loadedLines++;
        }

        file.close();

        cout << "   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: " << loadedLines << endl;
        cout << "   –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É: " << successfulInserts << endl;

        return true;
    }

    void saveToFile() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        string filename;
        cout << "   ‚ñ∑ –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ";
        cin >> filename;

        if (hashTable->exportToFile(filename, products)) {
            cout << "‚úî –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª " << filename << endl;
        } else {
            cout << "‚úñ –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ —Ñ–∞–π–ª " << filename << endl;
        }
    }

    void clearTable() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        cout << "   –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã! (y/n): ";
        char choice;
        cin >> choice;

        if (choice == 'y' || choice == 'Y') {
            hashTable->clear();
            products.clear();
            cout << "‚úî –¢–∞–±–ª–∏—Ü–∞ –æ—á–∏—â–µ–Ω–∞\n";
        } else {
            cout << "‚å´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n";
        }
    }

    void showStatistics() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        cout << "\n‚ïê‚ïê‚ïê –°–¢–ê–¢–ò–°–¢–ò–ö–ê –•–ï–®-–¢–ê–ë–õ–ò–¶–´ ‚ïê‚ïê‚ïê\n";
        cout << "–†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã: " << hashTable->getCapacity() << endl;
        cout << "–ó–∞–Ω—è—Ç–æ —Å–ª–æ—Ç–æ–≤: " << hashTable->getSize() << endl;
        cout << "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏: " << fixed << setprecision(2)
             << hashTable->getLoadFactor() << endl;
        cout << "–¢–æ–≤–∞—Ä–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ: " << products.size() << endl;

        // –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
        int emptySlots = hashTable->getCapacity() - hashTable->getSize();
        cout << "–ü—É—Å—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (status=0): " << emptySlots << endl;
        cout << "–ó–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (status=1): " << hashTable->getSize() << endl;
        cout << "–£–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (status=2): [—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ table]" << endl;

        cout << "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n";
    }

    void testFill() {
        if (!hashTable) {
            cout << "‚úñ –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É!\n";
            return;
        }

        cout << "   –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ? (y/n): ";
        char choice;
        cin >> choice;

        if (choice != 'y' && choice != 'Y') {
            cout << "‚å´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞\n";
            return;
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
        vector<Product> testProducts = {
            {1001, "–•–ª–µ–±_–±–µ–ª—ã–π", 25.50},
            {1002, "–ú–æ–ª–æ–∫–æ_3.2%", 68.90},
            {1003, "–°—ã—Ä_—Ä–æ—Å—Å–∏–π—Å–∫–∏–π", 890.00},
            {1004, "–ú–∞—Å–ª–æ_—Å–ª–∏–≤–æ—á–Ω–æ–µ", 120.75},
            {1005, "–Ø–π—Ü–∞_–°1", 95.60},
            {1006, "–ú—É–∫–∞_–ø—à–µ–Ω–∏—á–Ω–∞—è", 45.30},
            {1007, "–°–∞—Ö–∞—Ä_–ø–µ—Å–æ–∫", 55.80},
            {1008, "–°–æ–ª—å_–ø–æ–≤–∞—Ä–µ–Ω–Ω–∞—è", 15.20},
            {1009, "–ß–∞–π_—á–µ—Ä–Ω—ã–π", 185.40},
            {1010, "–ö–æ—Ñ–µ_—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π", 245.90}
        };

        int added = 0;
        for (const auto& product : testProducts) {
            int steps;
            if (hashTable->search(product.article, steps) == -1) {
                int newIndex = products.size();
                products.push_back(product);
                if (hashTable->insert(product.article, newIndex)) {
                    added++;
                }
            }
        }

        cout << "‚úî –î–æ–±–∞–≤–ª–µ–Ω–æ " << added << " —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤\n";
    }

public:
    HashTableTester() : hashTable(nullptr) {}

    ~HashTableTester() {
        if (hashTable) {
            delete hashTable;
        }
    }

    void run() {
        cout << "üõí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤" << endl;
        cout << "–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: –∞—Ä—Ç–∏–∫—É–ª –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–Ω–∞ (—á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª)" << endl;

        int choice;
        do {
            printMenu();
            cin >> choice;

            // –û—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –≤ —Å–ª—É—á–∞–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞
            if (cin.fail()) {
                cin.clear();
                cin.ignore(numeric_limits<streamsize>::max(), '\n');
                cout << "‚úñ –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.\n";
                continue;
            }

            switch (choice) {
                case 1: createHashTable(); break;
                case 2: addProduct(); break;
                case 3: removeProduct(); break;
                case 4: searchProduct(); break;
                case 5: showAllProducts(); break;
                case 6: showHashTable(); break;
                case 7: loadFromFile(); break;
                case 8: saveToFile(); break;
                case 9: clearTable(); break;
                case 10: showStatistics(); break;
                case 11: testFill(); break;
                case 0:
                    cout << "‚å´ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...\n";
                    break;
                default:
                    cout << "‚úñ –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.\n";
            }

        } while (choice != 0);
    }
};

int main() {
    system("chcp 65001");

    HashTableTester tester;
    tester.run();

    return 0;
}